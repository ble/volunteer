<html><body>
<script>
var url = window.location.toString();
var wsUrl = "ws://" + window.location.host + "/echo";

var ws = new WebSocket(wsUrl);
ws.addEventListener('open', function(e) {
  var socket = e.target;
  socket.messagesSent = 0;
  socket.send("hello");
  socket.messagesSent++;
});
ws.addEventListener('message', function(e) {
  var socket = e.target;
  window.console.log(e);
  socket.send("ping");
  socket.messagesSent++;
  if(socket.messagesSent > 5)
    socket.close();
});
ws.addEventListener('close', function(e) {
  var socket = e.target;
  window.console.log(e);
  window.console.log("closing");
});
</script>
</body></html>
